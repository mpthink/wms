<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.think.wms.dao.OutstoreMainDao">    
    
    <insert id="insertOutstoreMain" parameterType="OutstoreMain">
    	insert into
    		wms_outstore_main
    	<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="osmSn != null">osm_sn,</if>
			<if test="osmTicketNo != null">osm_ticket_no,</if>
			<if test="osmTicketTime != null">osm_ticket_time,</if>
			<if test="osmCarrier != null">osm_carrier,</if>
			<if test="osmCarNo != null">osm_car_no,</if>
			<if test="osmStatus != 0">osm_status,</if>
			<if test="osmTotal != 0">osm_total,</if>
			<if test="osmRemark != null">osm_remark,</if>
			<if test="osmCreator != null">osm_creator,</if>
			<if test="osmCreateDate != null">osm_create_date,</if>
			<if test="osmChargebacker != null">osm_chargebacker,</if>
			<if test="osmChargebackDate != null">osm_chargeback_date,</if>
			<if test="osmConfirmor != null">osm_confirmor,</if>
			<if test="osmConfirmDate != null">osm_confirm_date,</if>
			<if test="osmReviewer != null">osm_reviewer,</if>
			<if test="osmReviewDate != null">osm_review_date,</if>
			<if test="customer.customerId != 0">customer_id,</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="osmSn != null">#{osmSn},</if>
			<if test="osmTicketNo != null">#{osmTicketNo},</if>
			<if test="osmTicketTime != null">#{osmTicketTime},</if>
			<if test="osmCarrier != null">#{osmCarrier},</if>
			<if test="osmCarNo != null">#{osmCarNo},</if>
			<if test="osmStatus != 0">#{osmStatus},</if>
			<if test="osmTotal != 0">#{osmTotal},</if>
			<if test="osmRemark != null">#{osmRemark},</if>
			<if test="osmCreator != null">#{osmCreator},</if>
			<if test="osmCreateDate != null">#{osmCreateDate},</if>
			<if test="osmChargebacker != null">#{osmChargebacker},</if>
			<if test="osmChargebackDate != null">#{osmChargebackDate},</if>
			<if test="osmConfirmor != null">#{osmConfirmor},</if>
			<if test="osmConfirmDate != null">#{osmConfirmDate},</if>
			<if test="osmReviewer != null">#{osmReviewer},</if>
			<if test="osmReviewDate != null">#{osmReviewDate},</if>
			<if test="customer.customerId != 0">#{customer.customerId},</if>
		</trim>
    </insert>
    
	<delete id="deleteOutstoreMain" parameterType="int">
		delete
			from wms_outstore_main
		where
			osm_id=#{osmId}
	</delete>
    
    <update id="updateOutstoreMain" parameterType="OutstoreMain">
    	update 
    		wms_outstore_main
    	<trim prefix="set" suffixOverrides=",">
			<if test="osmSn != null">osm_sn=#{osmSn},</if>
			<if test="osmTicketNo != null">osm_ticket_no=#{osmTicketNo},</if>
			<if test="osmTicketTime != null">osm_ticket_time=#{osmTicketTime},</if>
			<if test="osmCarrier != null">osm_carrier=#{osmCarrier},</if>
			<if test="osmCarNo != null">osm_car_no=#{osmCarNo},</if>
			<if test="osmStatus != 0">osm_status=#{osmStatus},</if>
			<if test="osmTotal != 0">osm_total=#{osmTotal},</if>
			<if test="osmRemark != null">osm_remark=#{osmRemark},</if>
			<if test="osmCreator != null">osm_creator=#{osmCreator},</if>
			<if test="osmCreateDate != null">osm_create_date=#{osmCreateDate},</if>
			<if test="osmChargebacker != null">osm_chargebacker=#{osmChargebacker},</if>
			<if test="osmChargebackDate != null">osm_chargeback_date=#{osmChargebackDate},</if>
			<if test="osmConfirmor != null">osm_confirmor=#{osmConfirmor},</if>
			<if test="osmConfirmDate != null">osm_confirm_date=#{osmConfirmDate},</if>
			<if test="osmReviewer != null">osm_reviewer=#{osmReviewer},</if>
			<if test="osmReviewDate != null">osm_review_date=#{osmReviewDate},</if>
			<if test="customer.customerId != 0">customer_id=#{customer.customerId},</if>
		</trim>
    	where
    		osm_id=#{osmId}
    </update>
    
    <select id="queryById" resultType="OutstoreMain" parameterType="int">
        select 
			osm.osm_id,
			osm.osm_sn,
			osm.osm_ticket_no,
			osm.osm_ticket_time,
			osm.osm_carrier,
			osm.osm_car_no,
			osm.osm_status,
			osm.osm_total,
			osm.osm_remark,
			osm.osm_creator,
			osm.osm_create_date,
			osm.osm_chargebacker,
			osm.osm_chargeback_date,
			osm.osm_confirmor,
			osm.osm_confirm_date,
			osm.osm_reviewer,
			osm.osm_review_date,
			customer.customer_id "customer.customer_id",
			customer.customer_name "customer.customer_name",
			customer.customer_company "customer.customer_company"
        from 
        	wms_outstore_main osm
        left join wms_customer customer on customer.customer_id = osm.customer_id
        where osm.osm_id = #{osmId}
        order by osm.osm_create_date
    </select>
	
	
	<resultMap type="OutstoreMain" id="outstoreMainWithOutstoreSubs">
		<id property="osmId" column="osm.osm_id"/>
		<result property="osmSn" column="osm.osm_sn"/>
		<result property="osmTicketNo" column="osm.osm_ticket_no"/>
		<result property="osmTicketTime" column="osm.osm_ticket_time"/>
		<result property="osmCarrier" column="osm.osm_carrier"/>
		<result property="osmCarNo" column="osm.osm_car_no"/>
		<result property="osmStatus" column="osm.osm_status"/>
		<result property="osmTotal" column="osm.osm_total"/>
		<result property="osmRemark" column="osm.osm_remark"/>
		<result property="osmCreator" column="osm.osm_creator"/>
		<result property="osmCreateDate" column="osm.osm_create_date"/>
		<result property="osmChargebacker" column="osm.osm_chargebacker"/>
		<result property="osmChargebackDate" column="osm.osm_chargeback_date"/>
		<result property="osmConfirmor" column="osm.osm_confirmor"/>
		<result property="osmConfirmDate" column="osm.osm_confirm_date"/>
		<result property="osmReviewer" column="osm.osm_reviewer"/>
		<result property="osmReviewDate" column="osm.osm_review_date"/>
		<collection property="outstoreSubs" ofType="OutstoreSub">
			<id property="ossId" column="outstoreSubs.oss_id"/>
			<result property="osmId" column="outstoreSubs.osm_id"/>
			<result property="ossPlanQuantity" column="outstoreSubs.oss_plan_quantity"/>
			<result property="ossRealQuantity" column="outstoreSubs.oss_real_quantity"/>
			<result property="productQuality" column="outstoreSubs.product_quality"/>
			<result property="ossInsertTime" column="outstoreSubs.oss_insert_time"/>
			<result property="ossInsertOrder" column="outstoreSubs.oss_insert_order"/>
			<association property="product" javaType="Product">
				<result property="productId" column="outstoreSubs.product.product_id"/>
				<result property="productName" column="outstoreSubs.product.product_name"/>
				<result property="productUnit" column="outstoreSubs.product.product_unit"/>
				<association property="productCategory" javaType="ProductCategory">
					<result property="productCategoryId" column="outstoreSubs.product.productCategory.product_category_id"/>
					<result property="productCategoryName" column="outstoreSubs.product.productCategory.product_category_name"/>
				</association>
			</association>
			<association property="store" javaType="Store">
				<result property="storeId" column="outstoreSubs.store.store_id"/>
				<result property="storeName" column="outstoreSubs.store.store_name"/>
				<result property="storeSubParrent" column="outstoreSubs.store.store_sub_parrent"/>
				<result property="storeSubName" column="outstoreSubs.store.store_sub_name"/>
			</association>
		</collection>
		
	</resultMap>
	
	<select id="queryWithOutstoreSubsById" resultMap="outstoreMainWithOutstoreSubs" parameterType="int">
        select 
			osm.osm_id "osm.osm_id",
			osm.osm_sn "osm.osm_sn",
			osm.osm_ticket_no "osm.osm_ticket_no",
			osm.osm_ticket_time "osm.osm_ticket_time",
			osm.osm_carrier "osm.osm_carrier",
			osm.osm_car_no "osm.osm_car_no",
			osm.osm_status "osm.osm_status",
			osm.osm_total "osm.osm_total",
			osm.osm_remark "osm.osm_remark",
			osm.osm_creator "osm.osm_creator",
			osm.osm_create_date "osm.osm_create_date",
			osm.osm_chargebacker "osm.osm_chargebacker",
			osm.osm_chargeback_date "osm.osm_chargeback_date",
			osm.osm_confirmor "osm.osm_confirmor",
			osm.osm_confirm_date "osm.osm_confirm_date",
			osm.osm_reviewer "osm.osm_reviewer",
			osm.osm_review_date "osm.osm_review_date",
			customer.customer_id "customer.customer_id",
			customer.customer_name "customer.customer_name",
			customer.customer_company "customer.customer_company",
			oss.oss_id "outstoreSubs.oss_id",
			oss.osm_id "outstoreSubs.osm_id",
			oss.oss_plan_quantity "outstoreSubs.oss_plan_quantity",
			oss.oss_real_quantity "outstoreSubs.oss_real_quantity",
			product.product_id "outstoreSubs.product.product_id",
			product.product_name "outstoreSubs.product.product_name",
			product.product_unit "outstoreSubs.product.product_unit",
			productCategory.product_category_id "outstoreSubs.product.productCategory.product_category_id",
			productCategory.product_category_name "outstoreSubs.product.productCategory.product_category_name",
			oss.product_quality "outstoreSubs.product_quality",
			store.store_id "outstoreSubs.store.store_id",
			store.store_name "outstoreSubs.store.store_name",
			store.store_sub_parrent "outstoreSubs.store.store_sub_parrent",
			store.store_sub_name "outstoreSubs.store.store_sub_name",
			oss.oss_insert_time "outstoreSubs.oss_insert_time",
			oss.oss_insert_order "outstoreSubs.oss_insert_order"
        from 
        	wms_outstore_main osm
        left join wms_outstore_sub oss on oss.osm_id = osm.osm_id
        left join wms_customer customer on customer.customer_id = osm.customer_id
        left join wms_product product on product.product_id = oss.product_id
        left join wms_product_category productCategory on product.product_category_id = productCategory.product_category_id
		left join wms_store store on store.store_id = oss.store_id
        where osm.osm_id = #{osmId}
		order by oss.oss_insert_order,oss_id
    </select>

	<select id="queryByFileds" resultType="OutstoreMain" parameterType="map">
        select 
			osm.osm_id,
			osm.osm_sn,
			osm.osm_ticket_no,
			osm.osm_ticket_time,
			osm.osm_carrier,
			osm.osm_car_no,
			osm.osm_status,
			osm.osm_total,
			osm.osm_remark,
			osm.osm_creator,
			osm.osm_create_date,
			osm.osm_chargebacker,
			osm.osm_chargeback_date,
			osm.osm_confirmor,
			osm.osm_confirm_date,
			osm.osm_reviewer,
			osm.osm_review_date,
			customer.customer_id "customer.customer_id",
			customer.customer_name "customer.customer_name",
			customer.customer_company "customer.customer_company"
        from 
        	wms_outstore_main osm
        left join wms_customer customer on customer.customer_id = osm.customer_id
        <trim prefix="where " suffixOverrides="and |or ">
        	<if test="osmTicketNo != null">osm_ticket_no like CONCAT('%',#{osmTicketNo},'%') and</if>
        	<if test="osmCarrier != null">osm_carrier like CONCAT('%',#{osmCarrier},'%') and</if>
        	<if test="customerName != null">customer.customer_name like CONCAT('%',#{customerName},'%') and</if>
        	<if test="osmCreator != null">osm_creator like CONCAT('%',#{osmCreator},'%') and</if>
        	<if test="osmChargebacker != null">osm_chargebacker like CONCAT('%',#{osmTicketNo},'%') and</if>
        	<if test="osmConfirmor != null">osm_confirmor like CONCAT('%',#{osmConfirmor},'%') and</if>
        	<if test="osmreviewer != null">osm_reviewer like CONCAT('%',#{osmreviewer},'%') and</if>
        	<if test="osmStatus != null">osm_status = #{osmStatus} and</if>
        	<if test="osmCreateDateBegin != null">osm_create_date >= osmCreateDateBegin and</if>
        	<if test="osmCreateDateEnd != null">osm_create_date <![CDATA[ <= ]]> osmCreateDateEnd and</if>
        </trim>
        order by osm.osm_create_date
    </select>
    
    <select id="queryAll" resultType="OutstoreMain">
        select 
			osm.osm_id,
			osm.osm_sn,
			osm.osm_ticket_no,
			osm.osm_ticket_time,
			osm.osm_carrier,
			osm.osm_car_no,
			osm.osm_status,
			osm.osm_total,
			osm.osm_remark,
			osm.osm_creator,
			osm.osm_create_date,
			osm.osm_chargebacker,
			osm.osm_chargeback_date,
			osm.osm_confirmor,
			osm.osm_confirm_date,
			osm.osm_reviewer,
			osm.osm_review_date,
			customer.customer_id "customer.customer_id",
			customer.customer_name "customer.customer_name",
			customer.customer_company "customer.customer_company"
        from 
        	wms_outstore_main osm
        left join wms_customer customer on customer.customer_id = osm.customer_id
        order by osm.osm_create_date
    </select>
</mapper>