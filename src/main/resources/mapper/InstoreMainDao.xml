<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.think.wms.dao.InstoreMainDao">    
    
    <insert id="insertInstoreMain" parameterType="InstoreMain">
    	insert into
    		wms_instore_main
    	<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="ismSn != null">ism_sn,</if>
			<if test="ismTicketNo != null">ism_ticket_no,</if>
			<if test="ismTicketTime != null">ism_ticket_time,</if>
			<if test="ismCarrier != null">ism_carrier,</if>
			<if test="ismCarNo != null">ism_car_no,</if>
			<if test="ismStatus != 0">ism_status,</if>
			<if test="ismTotal != 0">ism_total,</if>
			<if test="ismRemark != null">ism_remark,</if>
			<if test="ismCreator != null">ism_creator,</if>
			<if test="ismCreateDate != null">ism_create_date,</if>
			<if test="ismChargebacker != null">ism_chargebacker,</if>
			<if test="ismChargebackDate != null">ism_chargeback_date,</if>
			<if test="ismConfirmor != null">ism_confirmor,</if>
			<if test="ismConfirmDate != null">ism_confirm_date,</if>
			<if test="ismReviewer != null">ism_reviewer,</if>
			<if test="ismReviewDate != null">ism_review_date,</if>
			<if test="customer.customerId != 0">customer_id,</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="ismSn != null">#{ismSn},</if>
			<if test="ismTicketNo != null">#{ismTicketNo},</if>
			<if test="ismTicketTime != null">#{ismTicketTime},</if>
			<if test="ismCarrier != null">#{ismCarrier},</if>
			<if test="ismCarNo != null">#{ismCarNo},</if>
			<if test="ismStatus != 0">#{ismStatus},</if>
			<if test="ismTotal != 0">#{ismTotal},</if>
			<if test="ismRemark != null">#{ismRemark},</if>
			<if test="ismCreator != null">#{ismCreator},</if>
			<if test="ismCreateDate != null">#{ismCreateDate},</if>
			<if test="ismChargebacker != null">#{ismChargebacker},</if>
			<if test="ismChargebackDate != null">#{ismChargebackDate},</if>
			<if test="ismConfirmor != null">#{ismConfirmor},</if>
			<if test="ismConfirmDate != null">#{ismConfirmDate},</if>
			<if test="ismReviewer != null">#{ismReviewer},</if>
			<if test="ismReviewDate != null">#{ismReviewDate},</if>
			<if test="customer.customerId != 0">#{customer.customerId},</if>
		</trim>
    </insert>
    
	<delete id="deleteInstoreMain" parameterType="int">
		delete
			from wms_instore_main
		where
			ism_id=#{ismId}
	</delete>
    
    <update id="updateInstoreMain" parameterType="InstoreMain">
    	update 
    		wms_instore_main
    	<trim prefix="set" suffixOverrides=",">
			<if test="ismSn != null">ism_sn=#{ismSn},</if>
			<if test="ismTicketNo != null">ism_ticket_no=#{ismTicketNo},</if>
			<if test="ismTicketTime != null">ism_ticket_time=#{ismTicketTime},</if>
			<if test="ismCarrier != null">ism_carrier=#{ismCarrier},</if>
			<if test="ismCarNo != null">ism_car_no=#{ismCarNo},</if>
			<if test="ismStatus != 0">ism_status=#{ismStatus},</if>
			<if test="ismTotal != 0">ism_total=#{ismTotal},</if>
			<if test="ismRemark != null">ism_remark=#{ismRemark},</if>
			<if test="ismCreator != null">ism_creator=#{ismCreator},</if>
			<if test="ismCreateDate != null">ism_create_date=#{ismCreateDate},</if>
			<if test="ismChargebacker != null">ism_chargebacker=#{ismChargebacker},</if>
			<if test="ismChargebackDate != null">ism_chargeback_date=#{ismChargebackDate},</if>
			<if test="ismConfirmor != null">ism_confirmor=#{ismConfirmor},</if>
			<if test="ismConfirmDate != null">ism_confirm_date=#{ismConfirmDate},</if>
			<if test="ismReviewer != null">ism_reviewer=#{ismReviewer},</if>
			<if test="ismReviewDate != null">ism_review_date=#{ismReviewDate},</if>
			<if test="customer.customerId != 0">customer_id=#{customer.customerId},</if>
		</trim>
    	where
    		ism_id=#{ismId}
    </update>
    
    <select id="queryById" resultType="InstoreMain" parameterType="int">
        select 
			ism.ism_id,
			ism.ism_sn,
			ism.ism_ticket_no,
			ism.ism_ticket_time,
			ism.ism_carrier,
			ism.ism_car_no,
			ism.ism_status,
			ism.ism_total,
			ism.ism_remark,
			ism.ism_creator,
			ism.ism_create_date,
			ism.ism_chargebacker,
			ism.ism_chargeback_date,
			ism.ism_confirmor,
			ism.ism_confirm_date,
			ism.ism_reviewer,
			ism.ism_review_date,
			customer.customer_id "customer.customer_id",
			customer.customer_name "customer.customer_name",
			customer.customer_company "customer.customer_company"
        from 
        	wms_instore_main ism
        left join wms_customer customer on customer.customer_id = ism.customer_id
        where ism.ism_id = #{ismId}
        order by ism.ism_create_date
    </select>
	
	
	<resultMap type="InstoreMain" id="instoreMainWithInstoreSubs">
		<id property="ismId" column="ism.ism_id"/>
		<result property="ismSn" column="ism.ism_sn"/>
		<result property="ismTicketNo" column="ism.ism_ticket_no"/>
		<result property="ismTicketTime" column="ism.ism_ticket_time"/>
		<result property="ismCarrier" column="ism.ism_carrier"/>
		<result property="ismCarNo" column="ism.ism_car_no"/>
		<result property="ismStatus" column="ism.ism_status"/>
		<result property="ismTotal" column="ism.ism_total"/>
		<result property="ismRemark" column="ism.ism_remark"/>
		<result property="ismCreator" column="ism.ism_creator"/>
		<result property="ismCreateDate" column="ism.ism_create_date"/>
		<result property="ismChargebacker" column="ism.ism_chargebacker"/>
		<result property="ismChargebackDate" column="ism.ism_chargeback_date"/>
		<result property="ismConfirmor" column="ism.ism_confirmor"/>
		<result property="ismConfirmDate" column="ism.ism_confirm_date"/>
		<result property="ismReviewer" column="ism.ism_reviewer"/>
		<result property="ismReviewDate" column="ism.ism_review_date"/>
		<collection property="instoreSubs" ofType="InstoreSub">
			<id property="issId" column="instoreSubs.iss_id"/>
			<result property="ismId" column="instoreSubs.ism_id"/>
			<result property="issParentId" column="instoreSubs.iss_parent_id"/>
			<result property="issPlanQuantity" column="instoreSubs.iss_plan_quantity"/>
			<result property="issRealQuantity" column="instoreSubs.iss_real_quantity"/>
			<result property="productQuality" column="instoreSubs.product_quality"/>
			<result property="issInsertTime" column="instoreSubs.iss_insert_time"/>
			<result property="issInsertOrder" column="instoreSubs.iss_insert_order"/>
			<association property="product" javaType="Product">
				<result property="productId" column="instoreSubs.product.product_id"/>
				<result property="productName" column="instoreSubs.product.product_name"/>
				<result property="productUnit" column="instoreSubs.product.product_unit"/>
				<association property="productCategory" javaType="ProductCategory">
					<result property="productCategoryId" column="instoreSubs.product.productCategory.product_category_id"/>
					<result property="productCategoryName" column="instoreSubs.product.productCategory.product_category_name"/>
				</association>
			</association>
			<association property="store" javaType="Store">
				<result property="storeId" column="instoreSubs.store.store_id"/>
				<result property="storeName" column="instoreSubs.store.store_name"/>
				<result property="storeSubParrent" column="instoreSubs.store.store_sub_parrent"/>
				<result property="storeSubName" column="instoreSubs.store.store_sub_name"/>
			</association>
		</collection>
		
	</resultMap>
	
	<select id="queryWithInstoreSubsById" resultMap="instoreMainWithInstoreSubs" parameterType="int">
        select 
			ism.ism_id "ism.ism_id",
			ism.ism_sn "ism.ism_sn",
			ism.ism_ticket_no "ism.ism_ticket_no",
			ism.ism_ticket_time "ism.ism_ticket_time",
			ism.ism_carrier "ism.ism_carrier",
			ism.ism_car_no "ism.ism_car_no",
			ism.ism_status "ism.ism_status",
			ism.ism_total "ism.ism_total",
			ism.ism_remark "ism.ism_remark",
			ism.ism_creator "ism.ism_creator",
			ism.ism_create_date "ism.ism_create_date",
			ism.ism_chargebacker "ism.ism_chargebacker",
			ism.ism_chargeback_date "ism.ism_chargeback_date",
			ism.ism_confirmor "ism.ism_confirmor",
			ism.ism_confirm_date "ism.ism_confirm_date",
			ism.ism_reviewer "ism.ism_reviewer",
			ism.ism_review_date "ism.ism_review_date",
			customer.customer_id "customer.customer_id",
			customer.customer_name "customer.customer_name",
			customer.customer_company "customer.customer_company",
			iss.iss_id "instoreSubs.iss_id",
			iss.ism_id "instoreSubs.ism_id",
			iss.iss_parent_id "instoreSubs.iss_parent_id",
			iss.iss_plan_quantity "instoreSubs.iss_plan_quantity",
			iss.iss_real_quantity "instoreSubs.iss_real_quantity",
			product.product_id "instoreSubs.product.product_id",
			product.product_name "instoreSubs.product.product_name",
			product.product_unit "instoreSubs.product.product_unit",
			productCategory.product_category_id "instoreSubs.product.productCategory.product_category_id",
			productCategory.product_category_name "instoreSubs.product.productCategory.product_category_name",
			iss.product_quality "instoreSubs.product_quality",
			store.store_id "instoreSubs.store.store_id",
			store.store_name "instoreSubs.store.store_name",
			store.store_sub_parrent "instoreSubs.store.store_sub_parrent",
			store.store_sub_name "instoreSubs.store.store_sub_name",
			iss.iss_insert_time "instoreSubs.iss_insert_time",
			iss.iss_insert_order "instoreSubs.iss_insert_order"
        from 
        	wms_instore_main ism
        left join wms_instore_sub iss on iss.ism_id = ism.ism_id
        left join wms_customer customer on customer.customer_id = ism.customer_id
        left join wms_product product on product.product_id = iss.product_id
        left join wms_product_category productCategory on product.product_category_id = productCategory.product_category_id
		left join wms_store store on store.store_id = iss.store_id
        where ism.ism_id = #{ismId}
		order by iss.iss_insert_order,iss_id
    </select>

	<select id="queryByFileds" resultType="InstoreMain" parameterType="map">
        select 
			ism.ism_id,
			ism.ism_sn,
			ism.ism_ticket_no,
			ism.ism_ticket_time,
			ism.ism_carrier,
			ism.ism_car_no,
			ism.ism_status,
			ism.ism_total,
			ism.ism_remark,
			ism.ism_creator,
			ism.ism_create_date,
			ism.ism_chargebacker,
			ism.ism_chargeback_date,
			ism.ism_confirmor,
			ism.ism_confirm_date,
			ism.ism_reviewer,
			ism.ism_review_date,
			customer.customer_id "customer.customer_id",
			customer.customer_name "customer.customer_name",
			customer.customer_company "customer.customer_company"
        from 
        	wms_instore_main ism
        left join wms_customer customer on customer.customer_id = ism.customer_id
        <trim prefix="where " suffixOverrides="and |or ">
        	<if test="ismTicketNo != null">ism_ticket_no like CONCAT('%',#{ismTicketNo},'%') and</if>
        	<if test="ismCarrier != null">ism_carrier like CONCAT('%',#{ismCarrier},'%') and</if>
        	<if test="customerName != null">customer.customer_name like CONCAT('%',#{customerName},'%') and</if>
        	<if test="ismCreator != null">ism_creator like CONCAT('%',#{ismCreator},'%') and</if>
        	<if test="ismChargebacker != null">ism_chargebacker like CONCAT('%',#{ismTicketNo},'%') and</if>
        	<if test="ismConfirmor != null">ism_confirmor like CONCAT('%',#{ismConfirmor},'%') and</if>
        	<if test="ismreviewer != null">ism_reviewer like CONCAT('%',#{ismreviewer},'%') and</if>
        	<if test="ismStatus != null">ism_status = #{ismStatus} and</if>
        	<if test="ismCreateDateBegin != null">ism_create_date >= ismCreateDateBegin and</if>
        	<if test="ismCreateDateEnd != null">ism_create_date <![CDATA[ <= ]]> ismCreateDateEnd and</if>
        </trim>
        order by ism.ism_create_date
    </select>
    
    <select id="queryAll" resultType="InstoreMain">
        select 
			ism.ism_id,
			ism.ism_sn,
			ism.ism_ticket_no,
			ism.ism_ticket_time,
			ism.ism_carrier,
			ism.ism_car_no,
			ism.ism_status,
			ism.ism_total,
			ism.ism_remark,
			ism.ism_creator,
			ism.ism_create_date,
			ism.ism_chargebacker,
			ism.ism_chargeback_date,
			ism.ism_confirmor,
			ism.ism_confirm_date,
			ism.ism_reviewer,
			ism.ism_review_date,
			customer.customer_id "customer.customer_id",
			customer.customer_name "customer.customer_name",
			customer.customer_company "customer.customer_company"
        from 
        	wms_instore_main ism
        left join wms_customer customer on customer.customer_id = ism.customer_id
        order by ism.ism_create_date
    </select>
</mapper>