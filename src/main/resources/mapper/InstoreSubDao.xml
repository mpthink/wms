<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.think.wms.dao.InstoreSubDao">    

    <insert id="insertInstoreSub" parameterType="List">
    	insert into
    		wms_instore_sub
    	<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="ismId != 0">ism_id,</if>
			<if test="issParentId != 0">iss_parent_id,</if>
			<if test="issPlanQuantity != 0">iss_plan_quantity,</if>
			<if test="issRealQuantity != 0">iss_real_quantity,</if>
			<if test="product.productId != 0">product_id,</if>
			<if test="productQuality != 0">product_quality,</if>
			<if test="store.storeId != 0">store_id,</if>
			<if test="issInsertOrder != 0">iss_insert_order,</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="ismId != 0">#{ismId},</if>
			<if test="issParentId != 0">#{issParentId},</if>
			<if test="issPlanQuantity != 0">#{issPlanQuantity},</if>
			<if test="issRealQuantity != 0">#{issRealQuantity},</if>
			<if test="product.productId != 0">#{product.productId},</if>
			<if test="productQuality != 0">#{productQuality},</if>
			<if test="store.storeId != 0">#{store.storeId},</if>
			<if test="issInsertOrder != 0">#{issInsertOrder},</if>
		</trim>
    </insert>
    
    <insert id="insertInstoreSubList" parameterType="List">
    	insert into
    		wms_instore_sub(ism_id,iss_parent_id,iss_plan_quantity,iss_real_quantity,product_id,product_quality,store_id,iss_insert_order)
		values
		<foreach collection="list" item="item" separator=",">
			( #{item.ismId},#{item.issParentId},#{item.issPlanQuantity},#{item.issRealQuantity},
			  #{item.product.productId},#{item.productQuality},#{item.store.storeId},#{item.issInsertOrder} )
		</foreach>
    </insert>
    
	<delete id="deleteInstoreSubByIssId" parameterType="int">
		delete
			from wms_instore_sub
		where
			iss_id=#{issId}
	</delete>
	
	<delete id="deleteInstoreSubByIsmId" parameterType="int">
		delete
			from wms_instore_sub
		where
			ism_id=#{ismId}
	</delete>
	
	<delete id="deleteInstoreSubByIssParentId" parameterType="int">
		delete
			from wms_instore_sub
		<where>
			<if test="issParentId !=0">iss_parent_id=#{issParentId}</if>
		</where>
	</delete>
    
    <update id="updateInstoreSub" parameterType="InstoreSub">
    	update 
    		wms_instore_sub
    	<trim prefix="set" suffixOverrides=",">
    		<if test="ismId != 0">ism_id=#{ismId},</if>
    		<if test="issParentId != 0">iss_parent_id=#{issParentId},</if>
			<if test="issPlanQuantity != 0">iss_plan_quantity=#{issPlanQuantity},</if>
			<if test="issRealQuantity != 0">iss_real_quantity=#{issRealQuantity},</if>
			<if test="product.productId != 0">product_id=#{product.productId},</if>
			<if test="productQuality != 0">product_quality=#{productQuality},</if>
			<if test="store.storeId != 0">store_id=#{store.storeId},</if>
			<if test="issInsertOrder != 0">iss_insert_order=#{issInsertOrder},</if>
		</trim>
    	where
    		iss_id=#{issId}
    </update>
	
	<!-- 学习下使用resultMap -->
	<resultMap type="InstoreSub" id="instoreSubResultMap">
		<id property="issId" column="iss_id"/>
		<result property="ismId" column="ism_id"/>
		<result property="issParentId" column="iss_parent_id"/>
		<result property="issPlanQuantity" column="iss_plan_quantity"/>
		<result property="issRealQuantity" column="iss_real_quantity"/>
		<result property="productQuality" column="product_quality"/>
		<association property="product" javaType="Product">
			<id property="productId" column="product_id"/>
			<result property="productName" column="product_name"/>
			<result property="productUnit" column="product_unit"/>
		</association>
		<association property="store" javaType="Store">
			<id property="storeId" column="store_id"/>
			<id property="storeName" column="store_name"/>
			<id property="storeSubParrent" column="store_sub_parrent"/>
			<id property="storeSubName" column="store_sub_name"/>
		</association>
	</resultMap>

	<select id="queryById" resultMap="instoreSubResultMap" parameterType="int">
		select
			iss_id,
			ism_id,
			iss_parent_id,
			iss_plan_quantity,
			iss_real_quantity,
			product.product_id "product_id",
			product.product_name "product_name",
			product.product_unit "product_unit",
			iss.product_quality,
			store.store_id "store_id",
			store.store_name "store_name",
			store.store_sub_parrent "store_sub_parrent",
			store.store_sub_name "store_sub_name",
			iss_insert_time,
			iss_insert_order
		from 
			wms_instore_sub iss
		left join wms_product product on product.product_id = iss.product_id
		left join wms_store store on store.store_id = iss.store_id
		where
			iss_id=#{issId}
	</select>
	
	<select id="queryByFileds" resultType="InstoreSub" parameterType="map">
		select
			iss_id,
			iss.ism_id "ism_id",
			iss_parent_id,
			iss_plan_quantity,
			iss_real_quantity,
			product.product_id "product.product_id",
			product.product_name "product.product_name",
			product.product_unit "product.product_unit",
			iss.product_quality,
			store.store_id "store.store_id",
			store.store_name "store.store_name",
			store.store_sub_parrent "store.store_sub_parrent",
			store.store_sub_name "store.store_sub_name",
			iss_insert_time,
			iss_insert_order,
			instoreMain.ism_id "instoreMain.ism_id",
			instoreMain.ism_ticket_no "instoreMain.ism_ticket_no",
			instoreMain.ism_ticket_time "instoreMain.ism_ticket_time",
			instoreMain.ism_carrier "instoreMain.ism_carrier",
			instoreMain.ism_status "instoreMain.ism_status",
			instoreMain.ism_creator "instoreMain.ism_creator",
			instoreMain.ism_create_date "instoreMain.ism_create_date",
			instoreMain.ism_chargebacker "instoreMain.ism_chargebacker",
			instoreMain.ism_chargeback_date "instoreMain.ism_chargeback_date",
			instoreMain.ism_confirmor "instoreMain.ism_confirmor",
			instoreMain.ism_confirm_date "instoreMain.ism_confirm_date",
			instoreMain.ism_reviewer "instoreMain.ism_reviewer",
			instoreMain.ism_review_date "instoreMain.ism_reveiw_date",
			customer.customer_id "instoreMain.customer.customer_id",
			customer.customer_name "instoreMain.customer.customer_name"
		from 
			wms_instore_sub iss
		left join wms_product product on product.product_id = iss.product_id
		left join wms_store store on store.store_id = iss.store_id
		left join wms_instore_main instoreMain on instoreMain.ism_id = iss.ism_id
		left join wms_customer customer on customer.customer_id = instoreMain.customer_id
		<trim prefix="where " suffixOverrides="and |or ">
        	<if test="ismTicketNo != null">ism_ticket_no like CONCAT('%',#{ismTicketNo},'%') and</if>
        	<if test="ismCarrier != null">ism_carrier like CONCAT('%',#{ismCarrier},'%') and</if>
        	<if test="customerName != null">customer.customer_name like CONCAT('%',#{customerName},'%') and</if>
        	<if test="ismCreator != null">ism_creator like CONCAT('%',#{ismCreator},'%') and</if>
        	<if test="ismChargebacker != null">ism_chargebacker like CONCAT('%',#{ismTicketNo},'%') and</if>
        	<if test="ismConfirmor != null">ism_confirmor like CONCAT('%',#{ismConfirmor},'%') and</if>
        	<if test="ismreviewer != null">ism_reviewer like CONCAT('%',#{ismreviewer},'%') and</if>
        	<if test="ismStatus != null">ism_status = #{ismStatus} and</if>
        	<if test="ismCreateDateBegin != null">ism_create_date >= ismCreateDateBegin and</if>
        	<if test="ismCreateDateEnd != null">ism_create_date <![CDATA[ <= ]]> ismCreateDateEnd and</if>
        	<if test="productName != null">product.product_name like CONCAT('%',#{productName},'%') and</if>
        </trim>
        order by instoreMain.ism_status asc,instoreMain.ism_id desc
	</select>

	<select id="queryAll" resultType="InstoreSub">
		select
			iss_id,
			iss.ism_id "ism_id",
			iss_parent_id,
			iss_plan_quantity,
			iss_real_quantity,
			product.product_id "product.product_id",
			product.product_name "product.product_name",
			product.product_unit "product.product_unit",
			iss.product_quality,
			store.store_id "store.store_id",
			store.store_name "store.store_name",
			store.store_sub_parrent "store.store_sub_parrent",
			store.store_sub_name "store.store_sub_name",
			iss_insert_time,
			iss_insert_order,
			instoreMain.ism_id "instoreMain.ism_id",
			instoreMain.ism_ticket_no "instoreMain.ism_ticket_no",
			instoreMain.ism_ticket_time "instoreMain.ism_ticket_time",
			instoreMain.ism_carrier "instoreMain.ism_carrier",
			instoreMain.ism_status "instoreMain.ism_status",
			instoreMain.ism_creator "instoreMain.ism_creator",
			instoreMain.ism_create_date "instoreMain.ism_create_date",
			instoreMain.ism_chargebacker "instoreMain.ism_chargebacker",
			instoreMain.ism_chargeback_date "instoreMain.ism_chargeback_date",
			instoreMain.ism_confirmor "instoreMain.ism_confirmor",
			instoreMain.ism_confirm_date "instoreMain.ism_confirm_date",
			instoreMain.ism_reviewer "instoreMain.ism_reviewer",
			instoreMain.ism_review_date "instoreMain.ism_reveiw_date",
			customer.customer_id "instoreMain.customer.customer_id",
			customer.customer_name "instoreMain.customer.customer_name"
		from 
			wms_instore_sub iss
		left join wms_product product on product.product_id = iss.product_id
		left join wms_store store on store.store_id = iss.store_id
		left join wms_instore_main instoreMain on instoreMain.ism_id = iss.ism_id
		left join wms_customer customer on customer.customer_id = instoreMain.customer_id
        order by instoreMain.ism_status asc,instoreMain.ism_id desc
	</select>

</mapper>